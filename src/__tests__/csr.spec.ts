import { isPEM, convertFromPem } from "../Csr"

const csr = `-----BEGIN CERTIFICATE REQUEST-----
MIIC1zCCAb8CAQAwgZExCzAJBgNVBAYTAkNOMRAwDgYDVQQIDAdleGFtcGxlMRAw
DgYDVQQHDAdleGFtcGxlMRAwDgYDVQQKDAdleGFtcGxlMRAwDgYDVQQLDAdleGFt
cGxlMRYwFAYDVQQDDA0qLmV4YW1wbGUuY29tMSIwIAYJKoZIhvcNAQkBFhNleGFt
cGxlQGV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
2Hk0p+T7CRPgm4zZATLcaLbcNTqn/OmnUQfcSXBXTSN27Pzz5PvTJy5RxVDAomUr
g0Dbk9vaMUJ+c+lEjWdg/xiWNJJ7yKfZn0VQdueJjJzg2uAXT7/ILfhS1mEl9arT
CtLuuMTZBUg2hhkfMvCr/VwTQDmtIfTy56n3qZGYoK+fJk3fQPMOC+Pk1CKRkChe
4Ta89JTR9s1tUAPjBHTaenUTGwqWSEN/sxsiy0uJsWyyp+xC8dinsw2YdGcBOIJO
9FqzseSyh2ClwS3WyXaOBOm5PnHQqZnH31tBFasqJyeV1hTNT94WWqxT40p9UeRT
ORydYRuZFl3B8i1RI22MGwIDAQABoAAwDQYJKoZIhvcNAQELBQADggEBAC2qsKjp
55+EZJMW4ujBpNX5cGNAFIftjrm38Hs++8NLqp+tBD8z6+LIQxtzUvrhcKGR0Fww
qA2NbDHAVW0Att6nWRbYQNoX9TWMKVPP2RrGogIFuM4nKXr2kiIiPAdedJo0Tiqp
aXmgnWh6UTEc8ylK0XIuGIF4tHS1QhcrqOUeYBFJ3Gj9pIVB6qdNh4by9zraXEY4
apHXnrrQ6CLvpJgHGsJAoxoRwxWW0GFdz7uOHz/s0rz+4NeHU+89eRSNIMEULfUP
p0buhuJwvzqNGvsB56Cg1nA8nUEgELhpfOsmwqUGg3wtlwnGnpdToeSeIyB79XsQ
52gAH0tc2BvW2wQ=
-----END CERTIFICATE REQUEST-----`

test("isPem", () => {
    expect(isPEM(csr)).toBeTruthy()

    const malformedCsr = `-----BEGINCERTIFICATE REQUEST-----
    MIIC1zCCAb8CAQAwgZExCzAJBgNVBAYTAkNOMRAwDgYDVQQIDAdleGFtcGxlMRAw
    DgYDVQQHDAdleGFtcGxlMRAwDgYDVQQKDAdleGFtcGxlMRAwDgYDVQQLDAdleGFt
    cGxlMRYwFAYDVQQDDA0qLmV4YW1wbGUuY29tMSIwIAYJKoZIhvcNAQkBFhNleGFt
    -----END CERTIFICATE REQUEST-----`

    expect(isPEM(malformedCsr)).toBeFalsy()
})

test("convertFromPem", () => {
    expect(convertFromPem(csr)).toBe(
        "MIIC1zCCAb8CAQAwgZExCzAJBgNVBAYTAkNOMRAwDgYDVQQIDAdleGFtcGxlMRAwDgYDVQQHDAdleGFtcGxlMRAwDgYDVQQKDAdleGFtcGxlMRAwDgYDVQQLDAdleGFtcGxlMRYwFAYDVQQDDA0qLmV4YW1wbGUuY29tMSIwIAYJKoZIhvcNAQkBFhNleGFtcGxlQGV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2Hk0p-T7CRPgm4zZATLcaLbcNTqn_OmnUQfcSXBXTSN27Pzz5PvTJy5RxVDAomUrg0Dbk9vaMUJ-c-lEjWdg_xiWNJJ7yKfZn0VQdueJjJzg2uAXT7_ILfhS1mEl9arTCtLuuMTZBUg2hhkfMvCr_VwTQDmtIfTy56n3qZGYoK-fJk3fQPMOC-Pk1CKRkChe4Ta89JTR9s1tUAPjBHTaenUTGwqWSEN_sxsiy0uJsWyyp-xC8dinsw2YdGcBOIJO9FqzseSyh2ClwS3WyXaOBOm5PnHQqZnH31tBFasqJyeV1hTNT94WWqxT40p9UeRTORydYRuZFl3B8i1RI22MGwIDAQABoAAwDQYJKoZIhvcNAQELBQADggEBAC2qsKjp55-EZJMW4ujBpNX5cGNAFIftjrm38Hs--8NLqp-tBD8z6-LIQxtzUvrhcKGR0FwwqA2NbDHAVW0Att6nWRbYQNoX9TWMKVPP2RrGogIFuM4nKXr2kiIiPAdedJo0TiqpaXmgnWh6UTEc8ylK0XIuGIF4tHS1QhcrqOUeYBFJ3Gj9pIVB6qdNh4by9zraXEY4apHXnrrQ6CLvpJgHGsJAoxoRwxWW0GFdz7uOHz_s0rz-4NeHU-89eRSNIMEULfUPp0buhuJwvzqNGvsB56Cg1nA8nUEgELhpfOsmwqUGg3wtlwnGnpdToeSeIyB79XsQ52gAH0tc2BvW2wQ",
    )
})
